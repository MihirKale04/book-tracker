<% const title = "Books"; %>
<%- include("../layout", { title, body: `
  <section class="filters">
    <form method="get" action="/books">
      <div class="row">
        <input type="text" name="q" value="${escapeHtml(filter.q || "")}" placeholder="üîç Search title or author..." />
        <select name="status">
          <option value="">All statuses</option>
          <option value="to-read" ${filter.status === "to-read" ? "selected" : ""}>To Read</option>
          <option value="reading" ${filter.status === "reading" ? "selected" : ""}>Reading</option>
          <option value="read" ${filter.status === "read" ? "selected" : ""}>Read</option>
        </select>
        <button type="submit">Filter</button>
      </div>
    </form>
  </section>

  <section>
    ${books.length === 0 ? `
      <div class="empty-state">
        <p>üìñ No books found.</p>
        <p class="muted">Try adjusting your filters or <a href="/books/new">add a new book</a>.</p>
      </div>
    ` : `
      <ul class="list">
        ${books.map(b => `
          <li>
            <div class="row" style="justify-content: space-between; align-items: flex-start;">
              <div style="flex: 1;">
                <a href="/books/${b.id}"><strong>${escapeHtml(b.title)}</strong></a>
                <div class="muted" style="margin-top: 0.25rem;">by ${escapeHtml(b.author)}</div>
              </div>
              <div class="row" style="gap: 0.75rem; align-items: center;">
                <span class="badge ${b.status}">${b.status}</span>
                ${b.rating ? `<span class="rating">‚≠ê ${b.rating}/5</span>` : ""}
              </div>
            </div>
          </li>
        `).join("")}
      </ul>
    `}
  </section>
` }) %>

<script>
function escapeHtml(str) {
  if (str == null) return "";
  return String(str)
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}
</script>
